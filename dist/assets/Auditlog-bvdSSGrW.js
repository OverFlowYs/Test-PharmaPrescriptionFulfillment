import{g as U}from"./audits-B0vNCIIH.js";import{C as x,a as L}from"./CommonDetailDialog-B0OX1uNV.js";import{d as A,r as n,n as F,c as B,o as T,b as q,e,w as a,g as s,E as K,h as u,t as c}from"./index-DB7fDvaj.js";import"./client-2qhNOC3Y.js";const H=A({__name:"Auditlog",setup(M){const i=n(!1),b=n([]),m=n(!1),y=n(null),o=n({patientId:"",pharmacyId:"",status:""}),h=[{prop:"prescriptionId",label:"处方ID",width:120},{prop:"patientName",label:"患者姓名",width:120},{prop:"pharmacyName",label:"药房",width:150},{prop:"status",label:"状态",width:100,slot:"status"},{prop:"timestamp",label:"时间",width:180,slot:"timestamp"}],v=[{key:"prescriptionId",label:"处方ID"},{key:"patientName",label:"患者姓名"},{key:"patientId",label:"患者ID"},{key:"pharmacyName",label:"药房名称"},{key:"pharmacyId",label:"药房ID"},{key:"status",label:"状态",slot:"status"},{key:"timestamp",label:"时间",type:"date"}],w=[{key:"requested",title:"请求的药品",dataKey:"drugsRequested",columns:[{prop:"drugId",label:"药品ID",width:100},{prop:"drugName",label:"药品名称"},{prop:"dosage",label:"剂量",width:100}]},{key:"dispensed",title:"分发的药品",dataKey:"drugsDispensed",columns:[{prop:"drugId",label:"药品ID",width:100},{prop:"drugName",label:"药品名称"},{prop:"dosage",label:"剂量",width:100}]}],p=async()=>{i.value=!0;try{b.value=await U(o.value)}catch(d){K.error(d?.message||"加载失败")}finally{i.value=!1}},C=()=>{p()},D=()=>{o.value={patientId:"",pharmacyId:"",status:""},p()},S=d=>{y.value=d,m.value=!0},V=d=>new Date(d).toLocaleString("zh-CN");return F(p),(d,l)=>{const f=s("el-input"),r=s("el-form-item"),_=s("el-option"),k=s("el-select"),g=s("el-button"),N=s("el-form"),E=s("el-card"),I=s("el-tag");return T(),B("div",null,[l[6]||(l[6]=q("h2",{class:"mb-4"},"审计日志",-1)),e(E,{class:"mb-4"},{default:a(()=>[e(N,{model:o.value,inline:""},{default:a(()=>[e(r,{label:"患者ID"},{default:a(()=>[e(f,{modelValue:o.value.patientId,"onUpdate:modelValue":l[0]||(l[0]=t=>o.value.patientId=t),placeholder:"输入患者ID",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(r,{label:"药房ID"},{default:a(()=>[e(f,{modelValue:o.value.pharmacyId,"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.pharmacyId=t),placeholder:"输入药房ID",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(r,{label:"状态"},{default:a(()=>[e(k,{modelValue:o.value.status,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.status=t),placeholder:"选择状态",clearable:"",style:{width:"150px"}},{default:a(()=>[e(_,{label:"成功",value:"SUCCESS"}),e(_,{label:"失败",value:"FAILED"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:a(()=>[e(g,{type:"primary",onClick:C},{default:a(()=>[...l[4]||(l[4]=[u("筛选",-1)])]),_:1}),e(g,{onClick:D},{default:a(()=>[...l[5]||(l[5]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(x,{data:b.value,columns:h,loading:i.value,"show-actions":!0,"show-refresh-button":!0,onRefresh:p,onView:S},{status:a(({row:t})=>[e(I,{type:t.status==="SUCCESS"?"success":"danger"},{default:a(()=>[u(c(t.status==="SUCCESS"?"成功":"失败"),1)]),_:2},1032,["type"])]),timestamp:a(({row:t})=>[u(c(V(t.timestamp)),1)]),_:1},8,["data","loading"]),e(L,{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=t=>m.value=t),title:"审计日志详情",data:y.value,fields:v,"sub-tables":w,width:"800px"},{status:a(({value:t})=>[e(I,{type:t==="SUCCESS"?"success":"danger"},{default:a(()=>[u(c(t==="SUCCESS"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1},8,["modelValue","data"])])}}});export{H as default};

import{d as W,r as D,v as p,n as X,c as v,o as h,b as s,e as a,w as c,g as k,t as o,F as N,x as y,i as Y,y as I,j as n,z as A,A as x,B as C,C as P,D as Z,G as L,H as S,I as T,J as $,h as G,K as U,_ as ss}from"./index-DB7fDvaj.js";import{g as ts}from"./drugs-CBtlUZF2.js";import{g as as}from"./pharmacies-BV1EheJl.js";import{g as es}from"./prescriptions-Cncccosg.js";import{g as ls}from"./audits-B0vNCIIH.js";import"./client-2qhNOC3Y.js";const is={class:"dashboard"},os={class:"welcome-banner"},cs={class:"banner-content"},ns={class:"banner-icon"},ds={class:"stats-grid"},rs={class:"stat-card drugs"},us={class:"stat-header"},_s={class:"stat-icon"},vs={class:"stat-main"},hs={class:"stat-number"},ps={class:"stat-details"},gs={class:"stat-detail-item"},ms={class:"detail-value expired"},fs={class:"stat-detail-item"},bs={class:"detail-value low-stock"},Ds={class:"stat-card pharmacies"},ks={class:"stat-header"},Ls={class:"stat-icon"},ws={class:"stat-main"},Is={class:"stat-number"},Fs={class:"stat-details"},Es={class:"stat-detail-item"},Ns={class:"detail-value active"},ys={class:"stat-detail-item"},As={class:"detail-value total-drugs"},xs={class:"stat-card prescriptions"},Cs={class:"stat-header"},Ps={class:"stat-icon"},Ss={class:"stat-main"},Ts={class:"stat-number"},Gs={class:"stat-details"},Us={class:"stat-detail-item"},zs={class:"detail-value pending"},Bs={class:"stat-detail-item"},Vs={class:"detail-value success"},Ms={class:"stat-card audits"},js={class:"stat-header"},qs={class:"stat-icon"},Hs={class:"stat-main"},Js={class:"stat-number"},Ks={class:"stat-details"},Rs={class:"stat-detail-item"},Os={class:"detail-value failed"},Qs={class:"stat-detail-item"},Ws={class:"detail-value success"},Xs={class:"charts-section"},Ys={class:"chart-card"},Zs={class:"chart-container"},$s={class:"chart-bars"},st={class:"bar-info"},tt={class:"bar-label"},at={class:"bar-count"},et={class:"bar-track"},lt={class:"bar-percentage"},it={class:"chart-card"},ot={class:"chart-container"},ct={class:"chart-bars"},nt={class:"bar-info"},dt={class:"bar-label"},rt={class:"bar-count"},ut={class:"bar-track"},_t={class:"bar-percentage"},vt={class:"actions-status-section"},ht={class:"quick-actions-card"},pt={class:"actions-grid"},gt={class:"action-icon primary"},mt={class:"action-arrow"},ft={class:"action-icon success"},bt={class:"action-arrow"},Dt={class:"action-icon info"},kt={class:"action-arrow"},Lt={class:"action-icon warning"},wt={class:"action-arrow"},It={class:"system-status-card"},Ft={class:"status-list"},Et={class:"status-item success"},Nt={class:"status-indicator"},yt={class:"status-item success"},At={class:"status-indicator"},xt={key:0,class:"status-item warning"},Ct={class:"status-indicator"},Pt={class:"status-content"},St={class:"status-title"},Tt={key:1,class:"status-item info"},Gt={class:"status-indicator"},Ut={class:"status-content"},zt={class:"status-title"},Bt={key:2,class:"status-item danger"},Vt={class:"status-indicator"},Mt={class:"status-content"},jt={class:"status-title"},qt={class:"tables-section"},Ht={class:"table-card"},Jt={class:"table-container"},Kt={class:"table-id"},Rt={class:"patient-info"},Ot={class:"patient-avatar"},Qt={class:"patient-name"},Wt={class:"table-time"},Xt={class:"table-card"},Yt={class:"table-container"},Zt={class:"drug-info"},$t={class:"drug-name"},sa={class:"drug-manufacturer"},ta={class:"stock-number"},aa={class:"limit-number"},ea=W({__name:"Dashboard",setup(la){const g=Y(),_=D([]),m=D([]),u=D([]),f=D([]),d=p(()=>({drugs:{total:_.value.length,expired:_.value.filter(e=>new Date(e.expiry)<=new Date).length},pharmacies:{total:m.value.length,active:m.value.length},prescriptions:{total:u.value.length,pending:u.value.filter(e=>e.status==="PENDING").length,fulfilled:u.value.filter(e=>e.status==="FULFILLED").length},audits:{total:f.value.length,failed:f.value.filter(e=>e.status==="FAILED").length,success:f.value.filter(e=>e.status==="SUCCESS").length}})),z=p(()=>m.value.reduce((e,t)=>e+t.allocatedDrugs.length,0)),B=p(()=>u.value.sort((e,t)=>new Date(t.createdAt||"").getTime()-new Date(e.createdAt||"").getTime()).slice(0,5)),b=p(()=>_.value.filter(e=>e.stock<20).sort((e,t)=>e.stock-t.stock).slice(0,5)),V=p(()=>{const e=u.value.length;if(e===0)return[];const t={PENDING:u.value.filter(l=>l.status==="PENDING").length,FULFILLED:u.value.filter(l=>l.status==="FULFILLED").length,FAILED:u.value.filter(l=>l.status==="FAILED").length};return[{name:"待处理",value:t.PENDING,percentage:t.PENDING/e*100,color:"#e6a23c"},{name:"已处理",value:t.FULFILLED,percentage:t.FULFILLED/e*100,color:"#67c23a"},{name:"处理失败",value:t.FAILED,percentage:t.FAILED/e*100,color:"#f56c6c"}]}),M=p(()=>{const e=_.value.length;if(e===0)return[];const t={normal:_.value.filter(l=>l.stock>=50).length,low:_.value.filter(l=>l.stock>=20&&l.stock<50).length,critical:_.value.filter(l=>l.stock<20).length};return[{name:"库存充足",value:t.normal,percentage:t.normal/e*100,color:"#67c23a"},{name:"库存偏低",value:t.low,percentage:t.low/e*100,color:"#e6a23c"},{name:"库存不足",value:t.critical,percentage:t.critical/e*100,color:"#f56c6c"}]}),j=async()=>{try{const[e,t,l,r]=await Promise.all([ts(),as(),es(),ls()]);_.value=e,m.value=t,u.value=l,f.value=r}catch(e){console.error("Failed to fetch dashboard data:",e)}},q=()=>g.push("/drugs"),H=()=>g.push("/pharmacies"),J=()=>g.push("/prescriptions"),K=()=>g.push("/audits"),R=e=>{switch(e){case"PENDING":return"warning";case"FULFILLED":return"success";case"FAILED":return"danger";default:return"info"}},O=e=>{switch(e){case"PENDING":return"待处理";case"FULFILLED":return"已处理";case"FAILED":return"处理失败";default:return e}},Q=e=>e?new Date(e).toLocaleDateString("zh-CN"):"-";return X(j),(e,t)=>{const l=k("el-icon"),r=k("el-table-column"),F=k("el-tag"),E=k("el-table");return h(),v("div",is,[s("div",os,[s("div",cs,[t[0]||(t[0]=s("div",{class:"banner-text"},[s("h1",{class:"banner-title"},"药品处方管理系统"),s("p",{class:"banner-subtitle"},"欢迎使用药品处方履行管理系统，这里是您的数据概览")],-1)),s("div",ns,[a(l,null,{default:c(()=>[a(n(A))]),_:1})])])]),s("div",ds,[s("div",rs,[s("div",us,[s("div",_s,[a(l,null,{default:c(()=>[a(n(A))]),_:1})]),s("div",vs,[s("div",hs,o(d.value.drugs.total),1),t[1]||(t[1]=s("div",{class:"stat-label"},"药品总数",-1))])]),s("div",ps,[s("div",gs,[t[2]||(t[2]=s("span",{class:"detail-label"},"已过期",-1)),s("span",ms,o(d.value.drugs.expired),1)]),s("div",fs,[t[3]||(t[3]=s("span",{class:"detail-label"},"库存不足",-1)),s("span",bs,o(b.value.length),1)])])]),s("div",Ds,[s("div",ks,[s("div",Ls,[a(l,null,{default:c(()=>[a(n(x))]),_:1})]),s("div",ws,[s("div",Is,o(d.value.pharmacies.total),1),t[4]||(t[4]=s("div",{class:"stat-label"},"药房总数",-1))])]),s("div",Fs,[s("div",Es,[t[5]||(t[5]=s("span",{class:"detail-label"},"活跃药房",-1)),s("span",Ns,o(d.value.pharmacies.active),1)]),s("div",ys,[t[6]||(t[6]=s("span",{class:"detail-label"},"分配药品",-1)),s("span",As,o(z.value),1)])])]),s("div",xs,[s("div",Cs,[s("div",Ps,[a(l,null,{default:c(()=>[a(n(C))]),_:1})]),s("div",Ss,[s("div",Ts,o(d.value.prescriptions.total),1),t[7]||(t[7]=s("div",{class:"stat-label"},"处方总数",-1))])]),s("div",Gs,[s("div",Us,[t[8]||(t[8]=s("span",{class:"detail-label"},"待处理",-1)),s("span",zs,o(d.value.prescriptions.pending),1)]),s("div",Bs,[t[9]||(t[9]=s("span",{class:"detail-label"},"已处理",-1)),s("span",Vs,o(d.value.prescriptions.fulfilled),1)])])]),s("div",Ms,[s("div",js,[s("div",qs,[a(l,null,{default:c(()=>[a(n(P))]),_:1})]),s("div",Hs,[s("div",Js,o(d.value.audits.total),1),t[10]||(t[10]=s("div",{class:"stat-label"},"审计记录",-1))])]),s("div",Ks,[s("div",Rs,[t[11]||(t[11]=s("span",{class:"detail-label"},"失败",-1)),s("span",Os,o(d.value.audits.failed),1)]),s("div",Qs,[t[12]||(t[12]=s("span",{class:"detail-label"},"成功",-1)),s("span",Ws,o(d.value.audits.success),1)])])])]),s("div",Xs,[s("div",Ys,[t[13]||(t[13]=s("div",{class:"chart-header"},[s("h3",{class:"chart-title"},"处方状态分布"),s("div",{class:"chart-subtitle"},"实时监控处方处理状态")],-1)),s("div",Zs,[s("div",$s,[(h(!0),v(N,null,y(V.value,(i,w)=>(h(),v("div",{class:"chart-bar",key:w},[s("div",st,[s("span",tt,o(i.name),1),s("span",at,o(i.value),1)]),s("div",et,[s("div",{class:"bar-fill",style:U({width:i.percentage+"%",backgroundColor:i.color})},null,4)]),s("div",lt,o(Math.round(i.percentage))+"%",1)]))),128))])])]),s("div",it,[t[14]||(t[14]=s("div",{class:"chart-header"},[s("h3",{class:"chart-title"},"药品库存状态"),s("div",{class:"chart-subtitle"},"库存预警与监控")],-1)),s("div",ot,[s("div",ct,[(h(!0),v(N,null,y(M.value,(i,w)=>(h(),v("div",{class:"chart-bar",key:w},[s("div",nt,[s("span",dt,o(i.name),1),s("span",rt,o(i.value),1)]),s("div",ut,[s("div",{class:"bar-fill",style:U({width:i.percentage+"%",backgroundColor:i.color})},null,4)]),s("div",_t,o(Math.round(i.percentage))+"%",1)]))),128))])])])]),s("div",vt,[s("div",ht,[t[19]||(t[19]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"快速操作"),s("div",{class:"card-subtitle"},"常用功能快速访问")],-1)),s("div",pt,[s("div",{class:"action-item",onClick:q},[s("div",gt,[a(l,null,{default:c(()=>[a(n(Z))]),_:1})]),t[15]||(t[15]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"新增药品"),s("div",{class:"action-desc"},"添加新的药品信息")],-1)),s("div",mt,[a(l,null,{default:c(()=>[a(n(L))]),_:1})])]),s("div",{class:"action-item",onClick:J},[s("div",ft,[a(l,null,{default:c(()=>[a(n(C))]),_:1})]),t[16]||(t[16]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"处理处方"),s("div",{class:"action-desc"},"查看和处理处方")],-1)),s("div",bt,[a(l,null,{default:c(()=>[a(n(L))]),_:1})])]),s("div",{class:"action-item",onClick:H},[s("div",Dt,[a(l,null,{default:c(()=>[a(n(x))]),_:1})]),t[17]||(t[17]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"查看药房"),s("div",{class:"action-desc"},"管理药房信息")],-1)),s("div",kt,[a(l,null,{default:c(()=>[a(n(L))]),_:1})])]),s("div",{class:"action-item",onClick:K},[s("div",Lt,[a(l,null,{default:c(()=>[a(n(P))]),_:1})]),t[18]||(t[18]=s("div",{class:"action-content"},[s("div",{class:"action-title"},"审计日志"),s("div",{class:"action-desc"},"查看系统操作记录")],-1)),s("div",wt,[a(l,null,{default:c(()=>[a(n(L))]),_:1})])])])]),s("div",It,[t[25]||(t[25]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"系统状态"),s("div",{class:"card-subtitle"},"实时系统监控")],-1)),s("div",Ft,[s("div",Et,[s("div",Nt,[a(l,null,{default:c(()=>[a(n(S))]),_:1})]),t[20]||(t[20]=s("div",{class:"status-content"},[s("div",{class:"status-title"},"API 服务正常"),s("div",{class:"status-desc"},"所有接口响应正常")],-1))]),s("div",yt,[s("div",At,[a(l,null,{default:c(()=>[a(n(S))]),_:1})]),t[21]||(t[21]=s("div",{class:"status-content"},[s("div",{class:"status-title"},"数据库连接正常"),s("div",{class:"status-desc"},"数据同步正常")],-1))]),d.value.drugs.expired>0?(h(),v("div",xt,[s("div",Ct,[a(l,null,{default:c(()=>[a(n(T))]),_:1})]),s("div",Pt,[s("div",St,o(d.value.drugs.expired)+" 个药品已过期",1),t[22]||(t[22]=s("div",{class:"status-desc"},"需要及时处理",-1))])])):I("",!0),d.value.prescriptions.pending>0?(h(),v("div",Tt,[s("div",Gt,[a(l,null,{default:c(()=>[a(n($))]),_:1})]),s("div",Ut,[s("div",zt,o(d.value.prescriptions.pending)+" 个处方待处理",1),t[23]||(t[23]=s("div",{class:"status-desc"},"等待处理中",-1))])])):I("",!0),b.value.length>0?(h(),v("div",Bt,[s("div",Vt,[a(l,null,{default:c(()=>[a(n(T))]),_:1})]),s("div",Mt,[s("div",jt,o(b.value.length)+" 个药品库存不足",1),t[24]||(t[24]=s("div",{class:"status-desc"},"需要及时补货",-1))])])):I("",!0)])])]),s("div",qt,[s("div",Ht,[t[26]||(t[26]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"最近处方"),s("div",{class:"card-subtitle"},"最新处理的处方记录")],-1)),s("div",Jt,[a(E,{data:B.value,size:"small","max-height":"300",class:"modern-table"},{default:c(()=>[a(r,{prop:"id",label:"处方ID",width:"100"},{default:c(({row:i})=>[s("span",Kt,o(i.id),1)]),_:1}),a(r,{prop:"patientName",label:"患者",width:"100"},{default:c(({row:i})=>[s("div",Rt,[s("div",Ot,o(i.patientName?.charAt(0)||"?"),1),s("span",Qt,o(i.patientName||"未知"),1)])]),_:1}),a(r,{prop:"status",label:"状态",width:"100"},{default:c(({row:i})=>[a(F,{type:R(i.status),size:"small",class:"status-tag"},{default:c(()=>[G(o(O(i.status)),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"createdAt",label:"时间",width:"120"},{default:c(({row:i})=>[s("span",Wt,o(Q(i.createdAt)),1)]),_:1})]),_:1},8,["data"])])]),s("div",Xt,[t[27]||(t[27]=s("div",{class:"card-header"},[s("h3",{class:"card-title"},"药品库存预警"),s("div",{class:"card-subtitle"},"需要关注的库存情况")],-1)),s("div",Yt,[a(E,{data:b.value,size:"small","max-height":"300",class:"modern-table"},{default:c(()=>[a(r,{prop:"name",label:"药品名称"},{default:c(({row:i})=>[s("div",Zt,[s("div",$t,o(i.name),1),s("div",sa,o(i.manufacturer),1)])]),_:1}),a(r,{prop:"stock",label:"库存",width:"80"},{default:c(({row:i})=>[s("span",ta,o(i.stock),1)]),_:1}),a(r,{prop:"limit",label:"限额",width:"80"},{default:c(({row:i})=>[s("span",aa,o(i.limit),1)]),_:1}),a(r,{label:"状态",width:"100"},{default:c(({row:i})=>[a(F,{type:i.stock<10?"danger":"warning",size:"small",class:"status-tag"},{default:c(()=>[G(o(i.stock<10?"库存不足":"库存偏低"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])])])])}}}),ua=ss(ea,[["__scopeId","data-v-fa3a1993"]]);export{ua as default};

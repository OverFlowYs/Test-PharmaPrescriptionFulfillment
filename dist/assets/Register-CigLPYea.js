import{d as S,r as c,a as P,c as R,o as z,b as i,e as a,w as l,f as U,g as m,h as f,j as p,k,m as q,l as V,t as N,E as _,i as E,_ as I}from"./index-DB7fDvaj.js";import{C as A}from"./Captcha-D338Kq0E.js";const B={class:"register-container"},D={class:"register-card"},O={class:"register-footer"},T=S({__name:"Register",setup(J){const w=E(),g=c(),u=c(!1),d=c(),r=P({username:"",email:"",password:"",confirmPassword:"",captcha:""}),x={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-zA-Z])(?=.*\d)/,message:"密码必须包含字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(o,e,s)=>{e!==r.password?s(new Error("两次输入的密码不一致")):s()},trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:4,message:"验证码长度为 4 位",trigger:"blur"}]},b=o=>{r.captcha=o},v=async()=>{if(g.value)try{if(await g.value.validate(),d.value&&!d.value.verifyCaptcha(r.captcha)){_.error("验证码错误"),d.value.refreshCaptcha();return}u.value=!0,await new Promise(s=>setTimeout(s,1500));const o=JSON.parse(localStorage.getItem("users")||"[]");if(o.find(s=>s.username===r.username)){_.error("用户名已存在"),d.value?.refreshCaptcha();return}const e={id:Date.now().toString(),username:r.username,email:r.email,role:"user",createdAt:new Date().toISOString()};o.push(e),localStorage.setItem("users",JSON.stringify(o)),_.success("注册成功，请登录"),w.push("/login")}catch(o){console.error("Register error:",o)}finally{u.value=!1}},C=()=>{w.push("/login")};return(o,e)=>{const s=m("el-input"),n=m("el-form-item"),h=m("el-button"),y=m("el-form");return z(),R("div",B,[i("div",D,[e[7]||(e[7]=i("div",{class:"register-header"},[i("h1",null,"注册账户"),i("p",null,"创建您的药品管理系统账户")],-1)),a(y,{ref_key:"formRef",ref:g,model:r,rules:x,class:"register-form",onSubmit:U(v,["prevent"])},{default:l(()=>[a(n,{prop:"username"},{default:l(()=>[a(s,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.username=t),placeholder:"请输入用户名",size:"large","prefix-icon":p(k)},null,8,["modelValue","prefix-icon"])]),_:1}),a(n,{prop:"email"},{default:l(()=>[a(s,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=t=>r.email=t),placeholder:"请输入邮箱",size:"large","prefix-icon":p(q)},null,8,["modelValue","prefix-icon"])]),_:1}),a(n,{prop:"password"},{default:l(()=>[a(s,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=t=>r.password=t),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":p(V),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),a(n,{prop:"confirmPassword"},{default:l(()=>[a(s,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>r.confirmPassword=t),type:"password",placeholder:"请确认密码",size:"large","prefix-icon":p(V),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),a(n,{prop:"captcha"},{default:l(()=>[a(A,{modelValue:r.captcha,"onUpdate:modelValue":e[4]||(e[4]=t=>r.captcha=t),onChange:b},null,8,["modelValue"])]),_:1}),a(n,null,{default:l(()=>[a(h,{type:"primary",size:"large",loading:u.value,onClick:v,class:"register-btn"},{default:l(()=>[f(N(u.value?"注册中...":"注册"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),i("div",O,[i("p",null,[e[6]||(e[6]=f(" 已有账户？ ",-1)),a(h,{type:"text",onClick:C},{default:l(()=>[...e[5]||(e[5]=[f("立即登录",-1)])]),_:1})])])])])}}}),L=I(T,[["__scopeId","data-v-2fcac7ee"]]);export{L as default};

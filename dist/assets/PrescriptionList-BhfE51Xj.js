import{g as L,f as P}from"./prescriptions-Cncccosg.js";import{C as V,a as x}from"./CommonDetailDialog-B0OX1uNV.js";import{d as A,r as l,n as B,c as F,o as D,b as T,e as o,w as s,E as r,L as M,y as $,g as k,h as n,t as p,M as z}from"./index-DB7fDvaj.js";import"./client-2qhNOC3Y.js";const K=A({__name:"PrescriptionList",setup(G){const i=l(!1),u=l(null),m=l([]),c=l(!1),f=l(null),v=[{prop:"id",label:"处方ID",width:120},{prop:"patientName",label:"患者姓名",width:120},{prop:"pharmacyName",label:"药房",width:150},{prop:"status",label:"状态",width:100,slot:"status"},{prop:"createdAt",label:"创建时间",width:180,slot:"createdAt"}],I=[{key:"id",label:"处方ID"},{key:"patientName",label:"患者姓名"},{key:"patientId",label:"患者ID"},{key:"pharmacyName",label:"药房名称"},{key:"pharmacyId",label:"药房ID"},{key:"status",label:"状态",slot:"status"},{key:"createdAt",label:"创建时间",type:"date"},{key:"updatedAt",label:"更新时间",type:"date"}],N=[{key:"drugs",title:"处方药品",dataKey:"drugs",columns:[{prop:"drugId",label:"药品ID",width:100},{prop:"drugName",label:"药品名称"},{prop:"dosage",label:"剂量",width:100},{prop:"quantity",label:"数量",width:100}]}],d=async()=>{i.value=!0;try{m.value=await L()}catch(e){r.error(e?.message||"加载失败")}finally{i.value=!1}},y=e=>{f.value=e,c.value=!0},C=async e=>{try{await z.confirm("确认处理此处方？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),u.value=e;const t=await P(e);t.success?(r.success("处方处理成功"),await d()):r.error(`处理失败: ${t.errors?.join(", ")}`)}catch(t){t!=="cancel"&&r.error(t?.message||"处理失败")}finally{u.value=null}},g=e=>{switch(e){case"PENDING":return"warning";case"FULFILLED":return"success";case"FAILED":return"danger";default:return"info"}},b=e=>{switch(e){case"PENDING":return"待处理";case"FULFILLED":return"已处理";case"FAILED":return"处理失败";default:return e}},_=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return B(d),(e,t)=>{const w=k("el-tag"),h=k("el-button");return D(),F("div",null,[t[3]||(t[3]=T("h2",null,"处方管理",-1)),o(V,{data:m.value,columns:v,loading:i.value,"show-actions":!0,"show-refresh-button":!0,onRefresh:d,onView:y},{status:s(({row:a})=>[o(w,{type:g(a.status)},{default:s(()=>[n(p(b(a.status)),1)]),_:2},1032,["type"])]),createdAt:s(({row:a})=>[n(p(_(a.createdAt)),1)]),actions:s(({row:a})=>[o(h,{type:"primary",size:"small",onClick:E=>y(a)},{default:s(()=>[...t[1]||(t[1]=[n(" 查看详情 ",-1)])]),_:1},8,["onClick"]),a.status==="PENDING"?(D(),M(h,{key:0,type:"success",size:"small",onClick:E=>C(a.id),loading:u.value===a.id},{default:s(()=>[...t[2]||(t[2]=[n(" 处理 ",-1)])]),_:1},8,["onClick","loading"])):$("",!0)]),_:1},8,["data","loading"]),o(x,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),title:"处方详情",data:f.value,fields:I,"sub-tables":N},{status:s(({value:a})=>[o(w,{type:g(a)},{default:s(()=>[n(p(b(a)),1)]),_:2},1032,["type"])]),_:1},8,["modelValue","data"])])}}});export{K as default};

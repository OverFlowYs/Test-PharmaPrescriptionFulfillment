import{a as q,g as B}from"./drugs-CBtlUZF2.js";import{d as C,r as m,L as c,o as y,w as t,g as d,e as l,h as g,E as w,n as E,c as D,b as M,y as N,t as Y}from"./index-DB7fDvaj.js";import{C as A,a as L}from"./CommonDetailDialog-B0OX1uNV.js";import"./client-2qhNOC3Y.js";const R=C({__name:"AddDrugDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(U,{emit:b}){const v=b,a=m({name:"",manufacturer:"",batch:"",expiry:"",stock:0,limit:0}),i=m(!1),k={name:[{required:!0,message:"必填",trigger:"blur"}],batch:[{required:!0,message:"必填",trigger:"blur"}],expiry:[{required:!0,message:"必填",trigger:"change"}],stock:[{type:"number",required:!0,message:"必填",trigger:"change"}],limit:[{type:"number",required:!0,message:"必填",trigger:"change"}]},p=m(),_=async()=>{await p.value?.validate(),i.value=!0;try{await q({...a.value}),w.success("新增成功"),v("success"),v("update:modelValue",!1)}catch(f){w.error(f?.message||"提交失败")}finally{i.value=!1}};return(f,e)=>{const V=d("el-input"),s=d("el-form-item"),o=d("el-date-picker"),r=d("el-input-number"),u=d("el-form"),x=d("el-button"),$=d("el-dialog");return y(),c($,{title:"新增药品","model-value":f.modelValue,onClose:e[7]||(e[7]=n=>f.$emit("update:modelValue",!1)),width:"520px"},{footer:t(()=>[l(x,{onClick:e[6]||(e[6]=n=>f.$emit("update:modelValue",!1))},{default:t(()=>[...e[8]||(e[8]=[g("取消",-1)])]),_:1}),l(x,{type:"primary",loading:i.value,onClick:_},{default:t(()=>[...e[9]||(e[9]=[g("提交",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(u,{model:a.value,rules:k,ref_key:"formRef",ref:p,"label-width":"96px"},{default:t(()=>[l(s,{label:"名称",prop:"name"},{default:t(()=>[l(V,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),style:{width:"80%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"生产商",prop:"manufacturer"},{default:t(()=>[l(V,{modelValue:a.value.manufacturer,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.manufacturer=n),style:{width:"80%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"批次",prop:"batch"},{default:t(()=>[l(V,{modelValue:a.value.batch,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.batch=n),style:{width:"80%"}},null,8,["modelValue"])]),_:1}),l(s,{label:"有效期",prop:"expiry"},{default:t(()=>[l(o,{modelValue:a.value.expiry,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.expiry=n),type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(s,{label:"库存",prop:"stock"},{default:t(()=>[l(r,{modelValue:a.value.stock,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.stock=n),min:0},null,8,["modelValue"])]),_:1}),l(s,{label:"药房限额",prop:"limit"},{default:t(()=>[l(r,{modelValue:a.value.limit,"onUpdate:modelValue":e[5]||(e[5]=n=>a.value.limit=n),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}}),S={key:0},K=C({__name:"DrugsList",setup(U){const b=m(!1),v=m([]),a=m(!1),i=m(!1),k=m(null),p=s=>new Date(s.expiry)<new Date,_=[{prop:"id",label:"ID",width:100},{prop:"name",label:"名称"},{prop:"manufacturer",label:"生产商"},{prop:"batch",label:"批次",width:120},{prop:"expiry",label:"有效期",width:140,slot:"expiry"},{prop:"stock",label:"库存",width:100},{prop:"limit",label:"药房限额",width:120},{prop:"status",label:"状态",width:100,slot:"status"}],f=[{key:"id",label:"药品ID"},{key:"name",label:"药品名称"},{key:"manufacturer",label:"生产商"},{key:"batch",label:"批次"},{key:"expiry",label:"有效期",type:"date"},{key:"stock",label:"库存"},{key:"limit",label:"药房限额"},{key:"status",label:"状态",slot:"status"}],e=async()=>{b.value=!0;try{v.value=await B()}catch(s){w.error(s?.message||"加载失败")}finally{b.value=!1}},V=s=>{k.value=s,i.value=!0};return E(e),(s,o)=>{const r=d("el-tag");return y(),D("div",null,[o[7]||(o[7]=M("h2",null,"药品管理",-1)),l(A,{data:v.value,columns:_,loading:b.value,"show-actions":!0,"show-add-button":!0,"show-refresh-button":!0,onAdd:o[0]||(o[0]=u=>a.value=!0),onRefresh:e,onView:V},{expiry:t(({row:u})=>[l(r,{type:p(u)?"danger":"success"},{default:t(()=>[g(Y(u.expiry)+" ",1),p(u)?(y(),D("span",S,"（过期）")):N("",!0)]),_:2},1032,["type"])]),status:t(({row:u})=>[p(u)?(y(),c(r,{key:0,type:"danger"},{default:t(()=>[...o[3]||(o[3]=[g("Expired",-1)])]),_:1})):(y(),c(r,{key:1,type:"success"},{default:t(()=>[...o[4]||(o[4]=[g("OK",-1)])]),_:1}))]),_:1},8,["data","loading"]),l(R,{modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=u=>a.value=u),onSuccess:e},null,8,["modelValue"]),l(L,{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=u=>i.value=u),title:"药品详情",data:k.value,fields:f},{status:t(({data:u})=>[p(u)?(y(),c(r,{key:0,type:"danger"},{default:t(()=>[...o[5]||(o[5]=[g("已过期",-1)])]),_:1})):(y(),c(r,{key:1,type:"success"},{default:t(()=>[...o[6]||(o[6]=[g("正常",-1)])]),_:1}))]),_:1},8,["modelValue","data"])])}}});export{K as default};
